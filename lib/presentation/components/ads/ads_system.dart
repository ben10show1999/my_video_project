import 'dart:async';
import 'package:flutter/material.dart';
import 'package:connectivity_plus/connectivity_plus.dart';
class SmartAdContainer extends StatelessWidget { final Widget adContent; final VoidCallback onClose; final double adAspectRatio; const SmartAdContainer({super.key, required this.adContent, required this.onClose, this.adAspectRatio = 16/9}); @override Widget build(BuildContext context) { return AspectRatio(aspectRatio: adAspectRatio, child: Container(decoration: BoxDecoration(color: const Color(0xFF151515), border: Border.all(color: Colors.white10)), child: Stack(children: [Positioned.fill(child: FittedBox(fit: BoxFit.contain, child: adContent)), Positioned(top: 8, right: 8, child: InkWell(onTap: onClose, child: Container(padding: const EdgeInsets.all(4), decoration: const BoxDecoration(color: Colors.black54, shape: BoxShape.circle), child: const Icon(Icons.close, color: Colors.white, size: 16))))]))); } }
class ReliableAdLoader extends StatefulWidget { final String adUrl; final Widget Function(BuildContext, String) adBuilder; const ReliableAdLoader({super.key, required this.adUrl, required this.adBuilder}); @override State<ReliableAdLoader> createState() => ReliableAdLoaderState(); }
class ReliableAdLoaderState extends State<ReliableAdLoader> { bool _err = false; Key _k = UniqueKey(); StreamSubscription? _sub; @override void initState() { super.initState(); _sub = Connectivity().onConnectivityChanged.listen((l) { if (_err && !l.contains(ConnectivityResult.none)) _retry(); }); } void _retry() { if (mounted) setState(() { _err = false; _k = UniqueKey(); }); } @override void dispose() { _sub?.cancel(); super.dispose(); } @override Widget build(BuildContext context) { if (_err) return const SizedBox(); return Builder(key: _k, builder: (c) => widget.adBuilder(c, widget.adUrl)); } }
